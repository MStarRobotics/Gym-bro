name: Secrets Presence Check

on:
    workflow_dispatch:

jobs:
    check-secrets:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - name: Verify CI & Release Secrets
              env:
                  ANDROID_KEYSTORE_BASE64: ${{ secrets.ANDROID_KEYSTORE_BASE64 || '' }}
                  ANDROID_KEYSTORE_PASSWORD: ${{ secrets.ANDROID_KEYSTORE_PASSWORD || '' }}
                  ANDROID_KEY_PASSWORD: ${{ secrets.ANDROID_KEY_PASSWORD || '' }}
                  ANDROID_KEY_ALIAS: ${{ secrets.ANDROID_KEY_ALIAS || '' }}
                  GPLAY_SERVICE_ACCOUNT_JSON: ${{ secrets.GPLAY_SERVICE_ACCOUNT_JSON || '' }}
                  GPLAY_PACKAGE_NAME: ${{ secrets.GPLAY_PACKAGE_NAME || '' }}
                  STAGING_AWS_ACCESS_KEY_ID: ${{ secrets.STAGING_AWS_ACCESS_KEY_ID || '' }}
                  STAGING_AWS_SECRET_ACCESS_KEY: ${{ secrets.STAGING_AWS_SECRET_ACCESS_KEY || '' }}
                  STAGING_S3_BUCKET: ${{ secrets.STAGING_S3_BUCKET || '' }}
                  STAGING_SSH_KEY: ${{ secrets.STAGING_SSH_KEY || '' }}
                  STAGING_HOST: ${{ secrets.STAGING_HOST || '' }}
                  GH_ADMIN_TOKEN: ${{ secrets.GH_ADMIN_TOKEN || '' }}
              run: |
                  set -e
                  missing=0
                  check_secret() { name=$1; val=$2; if [ -z "$val" ]; then echo "[MISSING] $name"; missing=1; else echo "[OK] $name"; fi }
                  check_secret "ANDROID_KEYSTORE_BASE64" "$ANDROID_KEYSTORE_BASE64"
                  check_secret "ANDROID_KEYSTORE_PASSWORD" "$ANDROID_KEYSTORE_PASSWORD"
                  check_secret "ANDROID_KEY_PASSWORD" "$ANDROID_KEY_PASSWORD"
                  check_secret "ANDROID_KEY_ALIAS" "$ANDROID_KEY_ALIAS"
                  check_secret "GPLAY_SERVICE_ACCOUNT_JSON" "${GPLAY_SERVICE_ACCOUNT_JSON}"
                  check_secret "GPLAY_PACKAGE_NAME" "${GPLAY_PACKAGE_NAME}"
                  check_secret "STAGING_AWS_ACCESS_KEY_ID" "${STAGING_AWS_ACCESS_KEY_ID}"
                  check_secret "STAGING_AWS_SECRET_ACCESS_KEY" "${STAGING_AWS_SECRET_ACCESS_KEY}"
                  check_secret "STAGING_S3_BUCKET" "${STAGING_S3_BUCKET}"
                  check_secret "STAGING_SSH_KEY" "${STAGING_SSH_KEY}"
                  check_secret "STAGING_HOST" "${STAGING_HOST}"
                  check_secret "GH_ADMIN_TOKEN" "${GH_ADMIN_TOKEN}"
                  if [ $missing -ne 0 ]; then echo "Some secrets are missing. Please add them in Settings -> Secrets -> Actions"; exit 1; fi
